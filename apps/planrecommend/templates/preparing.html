{% extends "base.html" %}

{% load static %}
{% block extra_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'planrecommend/preparing.css' %}">
{% endblock %}

{% block content %}
<div class="card mb-4 mt-3 center shadow-sm" style="width: 30%; margin: 0 auto; text-align: center; height: 300px; display: flex; justify-content: center; align-items: center;">
    <div class="card-body">
        <!-- 아이콘 전환 -->
        <div id="icon-container">
            <i class="bi bi-globe-asia-australia" style="display: none;"></i>
            <i class="bi bi-calendar2-check-fill" style="display: none;"></i>
            <i class="bi bi-sunglasses-fill" style="display: none;"></i>
            <i class="bi bi-emoji-sunglasses-fill" style="display: none;"></i>
            <i class="bi bi-map-fill" style="display: none;"></i>
        </div>
        <h3>여행 스타일에 맞는<br>
        맞춤 일정을<br>
        준비중입니다.</h3>
        <p id="preparing" class="mb-4">잠시만 기다려 주세요.</p>
        <!-- 로딩 바 추가 -->
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
    </div>
</div>

<!-- 아이콘 전환 및 로딩바 -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const icons = document.querySelectorAll('#icon-container i');
        const loadingProgress = document.querySelector('.loading-progress');
        let currentIconIndex = 0;
        let progress = 0;

        icons[currentIconIndex].style.display = 'block';
        loadingProgress.style.width = '0%';

        const intervalId = setInterval(() => {
            // 아이콘 전환
            icons[currentIconIndex].style.display = 'none';
            currentIconIndex = (currentIconIndex + 1) % icons.length;
            icons[currentIconIndex].style.display = 'block';

            // 로딩 바
            if (progress < 100) {
                progress += 20; // 1초에 20%씩 증가
                loadingProgress.style.width = progress + '%';
            } else {
                clearInterval(intervalId); // 100%가 되면 interval을 멈춤
                window.location.href = '{% url "planrecommend:recommend" %}'; // 리디렉션할 URL
            }
        }, 1000); // 1초 간격
    });

    // URL 파라미터 전달
    function getQueryParams() {
        const params = new URLSearchParams(window.location.search);
        const city = params.get('city');
        const date = params.get('date');
        const who = params.get('who');
        const style = params.get('style');
        const plan = params.get('plan');

        return { city, date, who, style, plan };
    }

    function redirectToNextPage() {
        const params = getQueryParams();
        const url = `{% url 'planrecommend:recommend' %}?city=${encodeURIComponent(params.city)}&date=${encodeURIComponent(params.date)}&who=${encodeURIComponent(params.who)}&style=${encodeURIComponent(params.style)}&plan=${encodeURIComponent(params.plan)}`;
        window.location.href = url;
    }
</script>
{% endblock %}
